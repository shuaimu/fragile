// Minimal fstream stub for fragile parsing
#ifndef _FRAGILE_FSTREAM_
#define _FRAGILE_FSTREAM_

#include "string"
#include "iostream"

namespace std {

// Basic filebuf stub
template<typename CharT>
class basic_filebuf {
public:
    basic_filebuf() = default;
    ~basic_filebuf() = default;

    basic_filebuf* open(const char* filename, ios_base::openmode mode) { (void)filename; (void)mode; return this; }
    basic_filebuf* open(const string& filename, ios_base::openmode mode) { return open(filename.c_str(), mode); }
    basic_filebuf* close() { return this; }
    bool is_open() const { return true; }
};

using filebuf = basic_filebuf<char>;
using wfilebuf = basic_filebuf<wchar_t>;

// Input file stream - inherits from basic_istream
template<typename CharT>
class basic_ifstream : public basic_istream<CharT> {
public:
    using openmode = typename ios_base::openmode;
    using seekdir = typename ios_base::seekdir;

    basic_ifstream() = default;
    explicit basic_ifstream(const char* filename, openmode mode = ios_base::in) { (void)filename; (void)mode; }
    explicit basic_ifstream(const string& filename, openmode mode = ios_base::in) { (void)filename; (void)mode; }
    ~basic_ifstream() = default;

    void open(const char* filename, openmode mode = ios_base::in) { (void)filename; (void)mode; }
    void open(const string& filename, openmode mode = ios_base::in) { open(filename.c_str(), mode); }
    bool is_open() const { return true; }
    void close() {}

    basic_ifstream& read(CharT* s, streamsize n) { (void)s; (void)n; return *this; }
    streamsize gcount() const { return 0; }
    basic_ifstream& getline(CharT* s, streamsize n) { (void)s; (void)n; return *this; }
    basic_ifstream& getline(CharT* s, streamsize n, CharT delim) { (void)s; (void)n; (void)delim; return *this; }

    basic_ifstream& seekg(streampos pos) { (void)pos; return *this; }
    basic_ifstream& seekg(streamoff off, seekdir dir) { (void)off; (void)dir; return *this; }
    streampos tellg() { return 0; }

    basic_filebuf<CharT>* rdbuf() const { return nullptr; }
};

using ifstream = basic_ifstream<char>;
using wifstream = basic_ifstream<wchar_t>;

// Output file stream - inherits from basic_ostream
template<typename CharT>
class basic_ofstream : public basic_ostream<CharT> {
public:
    using openmode = typename ios_base::openmode;
    using seekdir = typename ios_base::seekdir;

    basic_ofstream() = default;
    explicit basic_ofstream(const char* filename, openmode mode = ios_base::out) { (void)filename; (void)mode; }
    explicit basic_ofstream(const string& filename, openmode mode = ios_base::out) { (void)filename; (void)mode; }
    ~basic_ofstream() = default;

    void open(const char* filename, openmode mode = ios_base::out) { (void)filename; (void)mode; }
    void open(const string& filename, openmode mode = ios_base::out) { open(filename.c_str(), mode); }
    bool is_open() const { return true; }
    void close() {}

    basic_ofstream& write(const CharT* s, streamsize n) { (void)s; (void)n; return *this; }
    basic_ofstream& put(CharT c) { (void)c; return *this; }
    basic_ofstream& flush() { return *this; }

    basic_ofstream& seekp(streampos pos) { (void)pos; return *this; }
    basic_ofstream& seekp(streamoff off, seekdir dir) { (void)off; (void)dir; return *this; }
    streampos tellp() { return 0; }

    basic_filebuf<CharT>* rdbuf() const { return nullptr; }

    // Operator<< overloads (in addition to inherited ones from basic_ostream)
    using basic_ostream<CharT>::operator<<;
};

using ofstream = basic_ofstream<char>;
using wofstream = basic_ofstream<wchar_t>;

// Input/output file stream - inherits from basic_iostream
template<typename CharT>
class basic_fstream : public basic_iostream<CharT> {
public:
    using openmode = typename ios_base::openmode;

    basic_fstream() = default;
    explicit basic_fstream(const char* filename, openmode mode = ios_base::in | ios_base::out) { (void)filename; (void)mode; }
    explicit basic_fstream(const string& filename, openmode mode = ios_base::in | ios_base::out) { (void)filename; (void)mode; }
    ~basic_fstream() = default;

    void open(const char* filename, openmode mode = ios_base::in | ios_base::out) { (void)filename; (void)mode; }
    void open(const string& filename, openmode mode = ios_base::in | ios_base::out) { open(filename.c_str(), mode); }
    bool is_open() const { return true; }
    void close() {}

    basic_filebuf<CharT>* rdbuf() const { return nullptr; }
};

using fstream = basic_fstream<char>;
using wfstream = basic_fstream<wchar_t>;

} // namespace std

#endif // _FRAGILE_FSTREAM_
