// Minimal new stub for fragile parsing
#ifndef _FRAGILE_NEW_
#define _FRAGILE_NEW_

#include "cstdint"

namespace std {

// Exception classes for allocation failures
class bad_alloc {
public:
    bad_alloc() noexcept = default;
    bad_alloc(const bad_alloc&) noexcept = default;
    bad_alloc& operator=(const bad_alloc&) noexcept = default;
    virtual ~bad_alloc() noexcept = default;
    virtual const char* what() const noexcept { return "std::bad_alloc"; }
};

class bad_array_new_length : public bad_alloc {
public:
    bad_array_new_length() noexcept = default;
    virtual const char* what() const noexcept { return "std::bad_array_new_length"; }
};

// nothrow_t tag type
struct nothrow_t { explicit nothrow_t() = default; };
inline constexpr nothrow_t nothrow{};

// Placement new tag types
enum class align_val_t : size_t {};

// destroying_delete_t (C++20)
struct destroying_delete_t { explicit destroying_delete_t() = default; };
inline constexpr destroying_delete_t destroying_delete{};

// Hardware interference sizes (C++17)
inline constexpr size_t hardware_destructive_interference_size = 64;
inline constexpr size_t hardware_constructive_interference_size = 64;

// launder (C++17)
template<typename T>
[[nodiscard]] constexpr T* launder(T* p) noexcept {
    return p;
}

} // namespace std

// Global placement new operators
[[nodiscard]] inline void* operator new(size_t, void* p) noexcept { return p; }
[[nodiscard]] inline void* operator new[](size_t, void* p) noexcept { return p; }

// Placement delete operators (match placement new)
inline void operator delete(void*, void*) noexcept {}
inline void operator delete[](void*, void*) noexcept {}

// nothrow versions (not really needed for parsing but good for completeness)
[[nodiscard]] void* operator new(size_t count, const std::nothrow_t&) noexcept;
[[nodiscard]] void* operator new[](size_t count, const std::nothrow_t&) noexcept;

void operator delete(void* ptr, const std::nothrow_t&) noexcept;
void operator delete[](void* ptr, const std::nothrow_t&) noexcept;

#endif // _FRAGILE_NEW_
